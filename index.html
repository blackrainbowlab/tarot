<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini AI-Powered Tarot Reading</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298, #7e22ce, #1e3c72);
            background-size: 400% 400%;
            animation: cosmicShift 15s ease infinite;
            min-height: 100vh;
            color: #ffffff;
            overflow-x: hidden;
            position: relative;
        }

        @keyframes cosmicShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 1;
        }

        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
            position: relative;
            z-index: 2;
        }

        h1 {
            text-align: center;
            font-size: 3em;
            margin-bottom: 20px;
            text-shadow: 0 0 30px rgba(147, 51, 234, 0.8);
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { text-shadow: 0 0 30px rgba(147, 51, 234, 0.8); }
            to { text-shadow: 0 0 40px rgba(147, 51, 234, 1), 0 0 50px rgba(59, 130, 246, 0.8); }
        }

        .subtitle {
            text-align: center;
            font-size: 1.2em;
            margin-bottom: 40px;
            opacity: 0.9;
            font-style: italic;
        }

        .spread-selector {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .spread-selector h2 {
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .question-input {
            margin-bottom: 20px;
        }

        .question-input input {
            width: 100%;
            max-width: 500px;
            padding: 12px 20px;
            font-size: 1em;
            border-radius: 25px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-family: 'Georgia', serif;
        }

        .question-input input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .question-input input:focus {
            outline: none;
            border-color: #fbbf24;
            background: rgba(255, 255, 255, 0.15);
        }

        .spread-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1em;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            font-family: 'Georgia', serif;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.6);
        }

        button:active {
            transform: translateY(-1px);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .card-deck {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            min-height: 150px;
        }

        .card-back {
            aspect-ratio: 2/3;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 2px solid gold;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            position: relative;
            overflow: hidden;
        }

        .card-back::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60%;
            height: 60%;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.3), transparent);
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; }
            50% { transform: translate(-50%, -50%) scale(1.1); opacity: 0.8; }
        }

        .card-back:hover {
            transform: translateY(-10px) rotateZ(2deg);
            box-shadow: 0 10px 30px rgba(147, 51, 234, 0.5);
            border-color: #9333ea;
        }

        .spread-area {
            display: none;
            margin-bottom: 40px;
        }

        .spread-area.active {
            display: block;
        }

        .cards-container {
            display: grid;
            gap: 30px;
            margin-bottom: 30px;
            justify-items: center;
        }

        .cards-container.one-card {
            grid-template-columns: 1fr;
        }

        .cards-container.three-card {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .cards-container.celtic-cross {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }

        .card-position {
            text-align: center;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .position-label {
            font-size: 0.9em;
            color: #fbbf24;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .card {
            width: 200px;
            height: 300px;
            background: linear-gradient(135deg, #fef3c7, #fbbf24);
            border: 3px solid #f59e0b;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .card:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
        }

        .card-symbol {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .card-name {
            font-size: 1.1em;
            font-weight: bold;
            color: #1e3c72;
            margin-bottom: 10px;
            text-align: center;
            line-height: 1.2;
        }

        .card-meaning {
            font-size: 0.8em;
            color: #0f172a;
            text-align: center;
            line-height: 1.4;
            padding: 0 5px;
        }

        .card.reversed {
            transform: rotate(180deg);
        }

        .card.reversed:hover {
            transform: rotate(180deg) scale(1.05);
        }

        .interpretation {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .interpretation h3 {
            color: #fbbf24;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .interpretation p {
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fbbf24;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
            padding: 20px;
            color: #fbbf24;
        }

        .reset-button {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            margin-top: 30px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .reset-button:hover {
            box-shadow: 0 6px 25px rgba(239, 68, 68, 0.6);
        }

        .error-message {
            color: #ff6b6b;
            text-align: center;
            padding: 15px;
            background: rgba(255, 0, 0, 0.1);
            border-radius: 10px;
            margin: 15px 0;
        }

        @media (max-width: 768px) {
            h1 { font-size: 2em; }
            .cards-container { grid-template-columns: 1fr; }
            .card { width: 160px; height: 240px; }
            .card-name { font-size: 0.9em; }
            .card-meaning { font-size: 0.7em; }
        }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>
    
    <div class="container">
        <h1>✨ AI-Powered Tarot Reading ✨</h1>
        <p class="subtitle">Let Gemini interpret the wisdom of the cards</p>
        
        <div class="spread-selector" id="spreadSelector">
            <h2>What's on your mind?</h2>
            <div class="question-input">
                <input type="text" id="userQuestion" placeholder="Ask a question or describe your situation (optional)" />
            </div>
            <h2>Choose Your Reading</h2>
            <div class="spread-buttons">
                <button onclick="window.selectSpread('single')">Single Card (Quick Insight)</button>
                <button onclick="window.selectSpread('three')">Three Card (Past-Present-Future)</button>
                <button onclick="window.selectSpread('celtic')">Celtic Cross (Deep Dive)</button>
            </div>
        </div>
        
        <div class="card-deck" id="cardDeck" style="display: none;">
            <div class="card-back" onclick="window.drawCards()">🌙</div>
            <div class="card-back" onclick="window.drawCards()">⭐</div>
            <div class="card-back" onclick="window.drawCards()">🔮</div>
            <div class="card-back" onclick="window.drawCards()">✨</div>
            <div class="card-back" onclick="window.drawCards()">🌟</div>
            <div class="card-back" onclick="window.drawCards()">💫</div>
            <div class="card-back" onclick="window.drawCards()">🌙</div>
            <div class="card-back" onclick="window.drawCards()">⭐</div>
        </div>
        
        <div class="spread-area" id="spreadArea">
            <div class="cards-container" id="cardsContainer"></div>
            <div class="interpretation" id="interpretation" style="display: none;">
                <h3>Your Gemini AI Reading</h3>
                <div id="interpretationText"></div>
                <button class="reset-button" onclick="window.resetReading()">New Reading</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURATION: Add your Gemini API key here
        // Get your free key at: https://makersuite.google.com/app/apikey
        // ============================================
        
        // Define everything on window object to bypass SES lockdown
        window.currentSpread = null;
        window.drawnCards = [];
        window.userQuestion = '';
        
        // Complete 78-card tarot deck
        window.tarotDeck = [
            // Major Arcana (0-21)
            { symbol: "🎭", name: "The Fool", meaning: "New beginnings, innocence, spontaneity", reversed: "Recklessness, risk-taking" },
            { symbol: "🎩", name: "The Magician", meaning: "Manifestation, resourcefulness, power", reversed: "Manipulation, poor planning" },
            { symbol: "🔮", name: "The High Priestess", meaning: "Intuition, sacred knowledge", reversed: "Secrets, disconnected from intuition" },
            { symbol: "👑", name: "The Empress", meaning: "Femininity, beauty, nature, abundance", reversed: "Creative block, dependence" },
            { symbol: "⚔️", name: "The Emperor", meaning: "Authority, structure, control", reversed: "Tyranny, rigidity, coldness" },
            { symbol: "📿", name: "The Hierophant", meaning: "Spiritual wisdom, tradition", reversed: "Personal beliefs, freedom" },
            { symbol: "💕", name: "The Lovers", meaning: "Love, harmony, relationships", reversed: "Disharmony, imbalance" },
            { symbol: "🏇", name: "The Chariot", meaning: "Control, willpower, success", reversed: "Lack of control, aggression" },
            { symbol: "🦁", name: "Strength", meaning: "Inner strength, courage, patience", reversed: "Self doubt, weakness" },
            { symbol: "🕯️", name: "The Hermit", meaning: "Soul searching, introspection", reversed: "Isolation, loneliness" },
            { symbol: "☸️", name: "Wheel of Fortune", meaning: "Good luck, karma, life cycles", reversed: "Bad luck, lack of control" },
            { symbol: "⚖️", name: "Justice", meaning: "Justice, fairness, truth", reversed: "Unfairness, dishonesty" },
            { symbol: "🔄", name: "The Hanged Man", meaning: "Suspension, letting go", reversed: "Martyrdom, indecision" },
            { symbol: "💀", name: "Death", meaning: "Endings, beginnings, transformation", reversed: "Resistance to change" },
            { symbol: "🍺", name: "Temperance", meaning: "Balance, moderation, patience", reversed: "Imbalance, excess" },
            { symbol: "😈", name: "The Devil", meaning: "Bondage, addiction, materialism", reversed: "Releasing limiting beliefs" },
            { symbol: "⚡", name: "The Tower", meaning: "Sudden change, upheaval, chaos", reversed: "Personal transformation" },
            { symbol: "⭐", name: "The Star", meaning: "Hope, faith, purpose, renewal", reversed: "Lack of faith, despair" },
            { symbol: "🌙", name: "The Moon", meaning: "Illusion, fear, anxiety", reversed: "Release of fear" },
            { symbol: "☀️", name: "The Sun", meaning: "Joy, success, celebration", reversed: "Inner child, feeling down" },
            { symbol: "🎺", name: "Judgement", meaning: "Reflection, reckoning", reversed: "Self doubt, inner critic" },
            { symbol: "🌍", name: "The World", meaning: "Completion, accomplishment", reversed: "Lack of closure" },
            
            // Suit of Wands (22-35)
            { symbol: "🔥✨", name: "Ace of Wands", meaning: "Inspiration, new opportunities, growth", reversed: "Lack of direction, delays" },
            { symbol: "🔥🌍", name: "Two of Wands", meaning: "Planning, making decisions, leaving comfort zone", reversed: "Fear of change, poor planning" },
            { symbol: "🔥👁️", name: "Three of Wands", meaning: "Expansion, foresight, overseas opportunities", reversed: "Playing small, lack of foresight" },
            { symbol: "🔥🏡", name: "Four of Wands", meaning: "Celebration, harmony, home, relaxation", reversed: "Lack of harmony, transition" },
            { symbol: "🔥⚔️", name: "Five of Wands", meaning: "Competition, conflict, tension", reversed: "Avoiding conflict, respecting differences" },
            { symbol: "🔥🏆", name: "Six of Wands", meaning: "Success, public recognition, progress", reversed: "Private achievement, personal definition of success" },
            { symbol: "🔥🛡️", name: "Seven of Wands", meaning: "Challenge, perseverance, defense", reversed: "Exhaustion, giving up, overwhelmed" },
            { symbol: "🔥⚡", name: "Eight of Wands", meaning: "Movement, fast paced change, action", reversed: "Delays, frustration, resisting change" },
            { symbol: "🔥💪", name: "Nine of Wands", meaning: "Courage, persistence, test of faith", reversed: "Exhaustion, lack of resources, stubborn" },
            { symbol: "🔥📦", name: "Ten of Wands", meaning: "Burden, extra responsibility, hard work", reversed: "Doing it all, carrying the burden" },
            { symbol: "🔥📖", name: "Page of Wands", meaning: "Enthusiasm, exploration, discovery", reversed: "Lack of direction, procrastination" },
            { symbol: "🔥🏇", name: "Knight of Wands", meaning: "Energy, passion, adventure", reversed: "Anger, impulsiveness, recklessness" },
            { symbol: "🔥👑", name: "Queen of Wands", meaning: "Confidence, independence, determination", reversed: "Self-respect, self-confidence" },
            { symbol: "🔥🦁", name: "King of Wands", meaning: "Natural leader, vision, entrepreneur", reversed: "Impulsiveness, haste, ruthless" },
            
            // Suit of Cups (36-49)
            { symbol: "💧❤️", name: "Ace of Cups", meaning: "Love, new relationships, compassion", reversed: "Self-love, intuition, repressed emotions" },
            { symbol: "💧💑", name: "Two of Cups", meaning: "Partnership, unity, love, attraction", reversed: "Self-love, break-up, disharmony" },
            { symbol: "💧🎉", name: "Three of Cups", meaning: "Celebration, friendship, creativity", reversed: "Independence, alone time, hardcore partying" },
            { symbol: "💧🧘", name: "Four of Cups", meaning: "Meditation, contemplation, apathy", reversed: "Retreat, withdrawal, checking in" },
            { symbol: "💧😢", name: "Five of Cups", meaning: "Loss, grief, self-pity", reversed: "Acceptance, moving on, finding peace" },
            { symbol: "💧🎁", name: "Six of Cups", meaning: "Nostalgia, happy memories, reunion", reversed: "Moving forward, leaving home" },
            { symbol: "💧☁️", name: "Seven of Cups", meaning: "Choices, fantasy, illusion", reversed: "Clarity, personal values, overwhelmed" },
            { symbol: "💧🚶", name: "Eight of Cups", meaning: "Walking away, disillusionment, leaving behind", reversed: "Fear of change, fear of loss" },
            { symbol: "💧😊", name: "Nine of Cups", meaning: "Satisfaction, emotional stability, luxury", reversed: "Inner happiness, materialism, dissatisfaction" },
            { symbol: "💧🌈", name: "Ten of Cups", meaning: "Harmony, marriage, happiness, alignment", reversed: "Misalignment of values, broken home" },
            { symbol: "💧🐠", name: "Page of Cups", meaning: "Creative opportunities, curiosity, possibility", reversed: "New ideas, doubting intuition" },
            { symbol: "💧🤴", name: "Knight of Cups", meaning: "Romance, charm, imagination", reversed: "Jealousy, moodiness, unrealistic" },
            { symbol: "💧👸", name: "Queen of Cups", meaning: "Compassion, calm, comfort", reversed: "Martyrdom, insecurity, dependence" },
            { symbol: "💧🔱", name: "King of Cups", meaning: "Compassion, control, balance", reversed: "Coldness, moodiness, bad advice" },
            
            // Suit of Swords (50-63)
            { symbol: "⚔️💡", name: "Ace of Swords", meaning: "New ideas, mental clarity, breakthrough", reversed: "Inner clarity, re-thinking an idea" },
            { symbol: "⚔️👁️", name: "Two of Swords", meaning: "Difficult choices, indecision, stalemate", reversed: "Lesser of two evils, no right choice" },
            { symbol: "⚔️💔", name: "Three of Swords", meaning: "Heartbreak, suffering, grief", reversed: "Recovery, forgiveness, moving on" },
            { symbol: "⚔️😴", name: "Four of Swords", meaning: "Rest, restoration, contemplation", reversed: "Restlessness, burnout, stress" },
            { symbol: "⚔️🥊", name: "Five of Swords", meaning: "Conflict, disagreements, competition", reversed: "Reconciliation, making amends" },
            { symbol: "⚔️⛵", name: "Six of Swords", meaning: "Transition, leaving behind, moving on", reversed: "Emotional baggage, unfinished business" },
            { symbol: "⚔️🦊", name: "Seven of Swords", meaning: "Deception, trickery, tactics and strategy", reversed: "Coming clean, rethinking approach" },
            { symbol: "⚔️🔗", name: "Eight of Swords", meaning: "Imprisonment, entrapment, self-victimization", reversed: "Self acceptance, new perspective" },
            { symbol: "⚔️😰", name: "Nine of Swords", meaning: "Anxiety, worry, fear, depression", reversed: "Hope, reaching out, despair" },
            { symbol: "⚔️🌅", name: "Ten of Swords", meaning: "Betrayal, defeat, crisis, rock bottom", reversed: "Recovery, regeneration, resisting ending" },
            { symbol: "⚔️📚", name: "Page of Swords", meaning: "Curiosity, restlessness, mental energy", reversed: "Deception, manipulation, all talk" },
            { symbol: "⚔️🐎", name: "Knight of Swords", meaning: "Ambitious, action-oriented, driven", reversed: "Restless, unfocused, impulsive" },
            { symbol: "⚔️❄️", name: "Queen of Swords", meaning: "Complexity, perceptiveness, clear mindedness", reversed: "Cold hearted, cruel, bitterness" },
            { symbol: "⚔️⚖️", name: "King of Swords", meaning: "Mental clarity, intellectual power, authority", reversed: "Manipulative, cruel, weakness" },
            
            // Suit of Pentacles (64-77)
            { symbol: "💰🌱", name: "Ace of Pentacles", meaning: "Opportunity, prosperity, new venture", reversed: "Lost opportunity, missed chance" },
            { symbol: "💰🔄", name: "Two of Pentacles", meaning: "Balance, adaptability, time management", reversed: "Imbalance, disorganization, overwhelmed" },
            { symbol: "💰🏗️", name: "Three of Pentacles", meaning: "Teamwork, collaboration, building", reversed: "Disorganized, group conflict, competition" },
            { symbol: "💰🔒", name: "Four of Pentacles", meaning: "Conservation, frugality, security", reversed: "Greediness, stinginess, possessive" },
            { symbol: "💰❄️", name: "Five of Pentacles", meaning: "Need, poverty, insecurity", reversed: "Recovery, charity, improvement" },
            { symbol: "💰🤝", name: "Six of Pentacles", meaning: "Charity, generosity, sharing", reversed: "Strings attached, stinginess, power and domination" },
            { symbol: "💰🌾", name: "Seven of Pentacles", meaning: "Hard work, perseverance, diligence", reversed: "Lack of reward, lack of results" },
            { symbol: "💰🔨", name: "Eight of Pentacles", meaning: "Apprenticeship, passion, high standards", reversed: "Lack of passion, uninspired, no motivation" },
            { symbol: "💰🦚", name: "Nine of Pentacles", meaning: "Fruits of labor, rewards, luxury", reversed: "Reckless spending, living beyond means" },
            { symbol: "💰🏰", name: "Ten of Pentacles", meaning: "Legacy, culmination, inheritance", reversed: "Fleeting success, lack of stability" },
            { symbol: "💰📝", name: "Page of Pentacles", meaning: "Ambition, diligence, new opportunity", reversed: "Lack of commitment, grounded, poor planning" },
            { symbol: "💰🐂", name: "Knight of Pentacles", meaning: "Efficiency, hard work, responsibility", reversed: "Laziness, obsessiveness, work without reward" },
            { symbol: "💰🌻", name: "Queen of Pentacles", meaning: "Practicality, creature comforts, financial security", reversed: "Self-centeredness, jealousy, smothering" },
            { symbol: "💰👔", name: "King of Pentacles", meaning: "Abundance, prosperity, security", reversed: "Greed, indulgence, sensuality" }
        ];
        
        // Functions attached to window
        window.selectSpread = function(type) {
            window.currentSpread = type;
            window.userQuestion = document.getElementById('userQuestion').value;
            document.getElementById('spreadSelector').style.display = 'none';
            document.getElementById('cardDeck').style.display = 'grid';
        };
        
        window.drawCards = function() {
            if (!window.currentSpread) return;
            
            document.getElementById('cardDeck').style.display = 'none';
            document.getElementById('spreadArea').className = 'spread-area active';
            
            var container = document.getElementById('cardsContainer');
            container.innerHTML = '';
            
            var positions = [];
            var cardCount = 0;
            
            if (window.currentSpread === 'single') {
                positions = ['Present Situation'];
                cardCount = 1;
                container.className = 'cards-container one-card';
            } else if (window.currentSpread === 'three') {
                positions = ['Past', 'Present', 'Future'];
                cardCount = 3;
                container.className = 'cards-container three-card';
            } else if (window.currentSpread === 'celtic') {
                positions = ['Present Situation', 'Challenge/Cross', 'Distant Past', 'Recent Past', 'Possible Outcome', 
                            'Immediate Future', 'Your Approach', 'External Influences', 'Hopes and Fears', 'Final Outcome'];
                cardCount = 10;
                container.className = 'cards-container celtic-cross';
            }
            
            window.drawnCards = [];
            var shuffled = window.tarotDeck.slice();
            for (var i = shuffled.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = shuffled[i];
                shuffled[i] = shuffled[j];
                shuffled[j] = temp;
            }
            
            for (var i = 0; i < cardCount; i++) {
                var card = shuffled[i];
                var isReversed = Math.random() > 0.5;
                window.drawnCards.push({
                    symbol: card.symbol,
                    name: card.name,
                    meaning: card.meaning,
                    reversed: card.reversed,
                    isReversed: isReversed,
                    position: positions[i]
                });
                
                var cardDiv = document.createElement('div');
                cardDiv.className = 'card-position';
                
                var posLabel = document.createElement('div');
                posLabel.className = 'position-label';
                posLabel.textContent = positions[i];
                
                var cardEl = document.createElement('div');
                cardEl.className = 'card' + (isReversed ? ' reversed' : '');
                
                var symbolEl = document.createElement('div');
                symbolEl.className = 'card-symbol';
                symbolEl.textContent = card.symbol;
                
                var nameEl = document.createElement('div');
                nameEl.className = 'card-name';
                nameEl.textContent = card.name;
                
                var meaningEl = document.createElement('div');
                meaningEl.className = 'card-meaning';
                meaningEl.textContent = isReversed ? card.reversed : card.meaning;
                
                cardEl.appendChild(symbolEl);
                cardEl.appendChild(nameEl);
                cardEl.appendChild(meaningEl);
                
                cardDiv.appendChild(posLabel);
                cardDiv.appendChild(cardEl);
                
                container.appendChild(cardDiv);
            }
            
            // Get AI interpretation
            setTimeout(window.getAIInterpretation, 500);
        };
        
        window.getAIInterpretation = async function() {
            var interpretationDiv = document.getElementById('interpretation');
            var interpretationText = document.getElementById('interpretationText');
            
            // Show loading state
            interpretationDiv.style.display = 'block';
            interpretationText.innerHTML = '<div class="loading-text"><div class="loading"></div><span>Gemini is interpreting your cards...</span></div>';
            
            // Build the prompt for Gemini
            var prompt = "You are a skilled tarot reader providing an insightful and personalized reading. ";
            
            if (window.userQuestion) {
                prompt += "The querent asks: '" + window.userQuestion + "'. ";
            }
            
            prompt += "Here are the cards drawn in a " + window.currentSpread + " card spread:\n\n";
            
            for (var i = 0; i < window.drawnCards.length; i++) {
                var card = window.drawnCards[i];
                prompt += card.position + ": " + card.name + 
                         (card.isReversed ? " (Reversed)" : " (Upright)") + "\n";
            }
            
            prompt += "\nProvide a cohesive, meaningful interpretation that:\n";
            prompt += "1. Explains what each card means in its position\n";
            prompt += "2. Weaves the cards together into a narrative\n";
            prompt += "3. Offers practical insights and advice\n";
            prompt += "4. Is empowering and constructive\n";
            
            if (window.userQuestion) {
                prompt += "5. Directly addresses their question: " + window.userQuestion + "\n";
            }
            
            prompt += "\nKeep the tone mystical yet grounded, and limit the response to about 3-4 paragraphs.";
            
            // IMPORTANT: Replace 'YOUR-API-KEY' with your actual Gemini API key
            // Get your free API key at: https://makersuite.google.com/app/apikey
            var API_KEY = 'AIzaSyDoPmF8AI6cuG60LPYS3hRS-GN7fkGxZe8';
            
            try {
                // Make API call to Gemini
                const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=' + API_KEY, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.7,
                            maxOutputTokens: 1000,
                        }
                    })
                });
                
                if (!response.ok) {
                    throw new Error('API request failed: ' + response.status);
                }
                
                const data = await response.json();
                
                // Extract the response text from Gemini's format
                const aiResponse = data.candidates[0].content.parts[0].text;
                
                // Display the interpretation
                var html = '';
                if (window.userQuestion) {
                    html += '<p><strong>Your question:</strong> ' + window.userQuestion + '</p>';
                }
                
                html += '<p><strong>Cards drawn:</strong></p><ul>';
                for (var i = 0; i < window.drawnCards.length; i++) {
                    var card = window.drawnCards[i];
                    html += '<li>' + card.position + ': ' + card.name + 
                           (card.isReversed ? ' (Reversed)' : '') + '</li>';
                }
                html += '</ul>';
                
                // Format the AI response into paragraphs
                var paragraphs = aiResponse.split('\n\n');
                for (var j = 0; j < paragraphs.length; j++) {
                    if (paragraphs[j].trim()) {
                        html += '<p>' + paragraphs[j] + '</p>';
                    }
                }
                
                interpretationText.innerHTML = html;
                
            } catch (error) {
                console.error('Error getting Gemini interpretation:', error);
                // Check if it's likely an API key issue
                if (API_KEY === 'YOUR-API-KEY') {
                    interpretationText.innerHTML = '<div class="error-message"><strong>API Key Required!</strong><br>Please add your Gemini API key to use AI interpretations.<br><br>1. Get your free key at: <a href="https://makersuite.google.com/app/apikey" target="_blank" style="color: #fbbf24;">Google AI Studio</a><br>2. Replace "YOUR-API-KEY" in the code with your actual key<br><br>For now, here\'s a basic reading:</div>';
                    
                    // Show basic interpretation
                    var html = '';
                    if (window.userQuestion) {
                        html += '<p><strong>Your question:</strong> ' + window.userQuestion + '</p>';
                    }
                    
                    html += '<p><strong>Your cards:</strong></p>';
                    for (var i = 0; i < window.drawnCards.length; i++) {
                        var card = window.drawnCards[i];
                        html += '<p><strong>' + card.position + ':</strong> ' + card.name + 
                                (card.isReversed ? ' (Reversed)' : '') + ' - ' +
                                (card.isReversed ? card.reversed : card.meaning) + '</p>';
                    }
                    
                    interpretationText.innerHTML += html;
                } else {
                    // Fallback to basic interpretation for other errors
                    window.basicInterpretation();
                }
            }
        };
        
        window.basicInterpretation = function() {
            var interpretationText = document.getElementById('interpretationText');
            var html = '<div class="error-message">Unable to connect to Gemini AI. Make sure to add your API key!<br><small>Get a free key at: https://makersuite.google.com/app/apikey</small></div>';
            
            if (window.userQuestion) {
                html += '<p><strong>Your question:</strong> ' + window.userQuestion + '</p>';
            }
            
            html += '<p><strong>Your cards reveal:</strong></p>';
            for (var i = 0; i < window.drawnCards.length; i++) {
                var card = window.drawnCards[i];
                html += '<p><strong>' + card.position + ':</strong> ' + card.name + 
                        (card.isReversed ? ' (Reversed)' : '') + ' - ' +
                        (card.isReversed ? card.reversed : card.meaning) + '</p>';
            }
            
            html += '<p>Reflect on how these energies connect to your current situation.</p>';
            interpretationText.innerHTML = html;
        };
        
        window.resetReading = function() {
            window.currentSpread = null;
            window.drawnCards = [];
            window.userQuestion = '';
            document.getElementById('userQuestion').value = '';
            document.getElementById('spreadSelector').style.display = 'block';
            document.getElementById('cardDeck').style.display = 'none';
            document.getElementById('spreadArea').className = 'spread-area';
            document.getElementById('interpretation').style.display = 'none';
        };
        
        // Create stars after page loads
        window.onload = function() {
            var starsContainer = document.getElementById('stars');
            for (var i = 0; i < 100; i++) {
                var star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                starsContainer.appendChild(star);
            }
        };
    </script>
</body>
</html>
